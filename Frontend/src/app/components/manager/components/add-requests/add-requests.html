<div *ngIf="viewMode === 'card'">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div
      *ngFor="let req of filteredRequests"
      class="hover:shadow-lg hover:translate-y-[-2px] transition-all duration-300 border-l-4 rounded-lg bg-white border-[#7ee3db97] shadow-sm"
    >
      <div class="p-6">
        <div class="flex justify-between items-start mb-4">
          <div class="flex items-center gap-2">
            <h3 class="text-lg font-semibold text-slate-900">
              {{ req.employeeName }}
            </h3>
            <span
              *ngIf="req.departmentName"
              class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-700"
            >
              {{ req.departmentName }}
            </span>
          </div>
          <span
            class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium shadow-sm"
            [ngClass]="{
              'bg-gradient-to-r from-yellow-100 to-yellow-200 text-yellow-800':
                req.status === 'Pending',
              'bg-gradient-to-r from-[#7EE3DB] to-[#88F8BF] text-slate-900':
                req.status === 'Approved',
              'bg-gradient-to-r from-red-100 to-red-200 text-red-800':
                req.status === 'Rejected',
              'bg-gradient-to-r from-gray-100 to-gray-200 text-gray-800':
                req.status === 'Invalid' || req.status === 'Expired' || req.status === 'Canceled',
              'bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800':
                req.status === 'Arrived'
            }"
          >
            <ng-container *ngIf="req.status === 'Pending'">
              <svg
                class="w-4 h-4"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 384 512"
              >
                <path
                  fill="oklch(79.5% 0.184 86.047)"
                  d="M32 0C14.3 0 0 14.3 0 32S14.3 64 32 64l0 11c0 42.4 16.9 83.1 46.9 113.1L146.7 256 78.9 323.9C48.9 353.9 32 394.6 32 437l0 11c-17.7 0-32 14.3-32 32s14.3 32 32 32l32 0 256 0 32 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l0-11c0-42.4-16.9-83.1-46.9-113.1L237.3 256l67.9-67.9c30-30 46.9-70.7 46.9-113.1l0-11c17.7 0 32-14.3 32-32s-14.3-32-32-32L320 0 64 0 32 0zM96 75l0-11 192 0 0 11c0 19-5.6 37.4-16 53L112 128c-10.3-15.6-16-34-16-53zm16 309c3.5-5.3 7.6-10.3 12.1-14.9L192 301.3l67.9 67.9c4.6 4.6 8.6 9.6 12.1 14.9L112 384z"
                />
              </svg>
            </ng-container>

            <ng-container *ngIf="req.status === 'Approved'">
              <svg
                class="w-4 h-4"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 512 512"
              >
                <path
                  fill="oklch(62.7% 0.194 149.214)"
                  d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"
                />
              </svg>
            </ng-container>

            <ng-container *ngIf="req.status === 'Rejected'">
              <svg
                class="w-4 h-4"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 512 512"
              >
                <path
                  fill="oklch(57.7% 0.245 27.325)"
                  d="M367.2 412.5L99.5 144.8C77.1 176.1 64 214.5 64 256c0 106 86 192 192 192c41.5 0 79.9-13.1 111.2-35.5zm45.3-45.3C434.9 335.9 448 297.5 448 256c0-106-86-192-192-192c-41.5 0-79.9 13.1-111.2 35.5L412.5 367.2zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256z"
                />
              </svg>
            </ng-container>

            {{ req.status }}
          </span>
        </div>
        <div class="space-y-3 mt-2">
          <div class="flex items-center gap-2 text-sm text-slate-700">
            <svg
              class="w-4 h-4 text-[#7EE3DB]"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 448 512"
            >
              <path
                fill="currentColor"
                d="M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64C28.7 64 0 92.7 0 128v16 48V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V192 144 128c0-35.3-28.7-64-64-64H344V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24zM48 192h80v56H48V192zm0 104h80v64H48V296zm128 0h96v64H176V296zm144 0h80v64H320V296zm80-48H320V192h80v56zm0 160v40c0 8.8-7.2 16-16 16H320V408h80zm-128 0v56H176V408h96zm-144 0v56H64c-8.8 0-16-7.2-16-16V408h80zM272 248H176V192h96v56z"
              />
            </svg>
            <span class="font-medium">{{ req.from }} - {{ req.to }}</span>
          </div>
          <div
            class="flex items-start gap-2 text-sm text-slate-700"
            *ngIf="req.leaveType"
          >
            <svg
              class="w-4 h-4 mt-0.5 flex-shrink-0 text-[#7EE3DB]"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 512 512"
            >
              <path
                fill="currentColor"
                d="M184 48H328c4.4 0 8 3.6 8 8V96H176V56c0-4.4 3.6-8 8-8zm-56 8V96H64C28.7 96 0 124.7 0 160v96H192 320 512V160c0-35.3-28.7-64-64-64H384V56c0-30.9-25.1-56-56-56H184c-30.9 0-56 25.1-56 56zM512 288H320v32c0 17.7-14.3 32-32 32H224c-17.7 0-32-14.3-32-32V288H0V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V288z"
              />
            </svg>
            <div class="flex-1">
              <div class="flex items-center gap-2 flex-wrap">
                <span class="font-medium text-slate-800">{{
                  req.leaveType.title
                }}</span>
                <span
                  class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium"
                  [ngClass]="{
                    'bg-green-100 text-green-700': req.leaveType.isPaid,
                    'bg-gray-100 text-gray-700': !req.leaveType.isPaid
                  }"
                >
                  {{ req.leaveType.isPaid ? "Paid" : "Unpaid" }}
                </span>
              </div>
            </div>
          </div>

          <div class="flex items-center gap-2 text-xs text-slate-500">
            <svg
              class="w-3 h-3 text-[#7EE3DB]"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 512 512"
            >
              <path
                fill="currentColor"
                d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"
              />
            </svg>
            <span>Submitted {{ req.createdAt }}</span>
          </div>
        </div>
        <div class="mt-4 pt-4 border-t">
          <button
            class="w-full rounded bg-gradient-to-r from-[#7EE3DB] to-[#88F8BF] hover:bg-gradient-to-t border border-slate-500 text-slate-900 py-2 text-sm font-medium hover:cursor-pointer transition-all duration-200 transform"
            (click)="openDetails(req)"
          >
            View Details
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="errorMessage" class="mb-4 p-3 rounded border border-red-200 bg-red-50 text-red-700">
  {{ errorMessage }}
</div>

<div *ngIf="viewMode === 'table'" class="table-scroll-outer">
  <table class="min-w-full bg-white shadow-sm rounded overflow-hidden">
    <thead class="bg-gray-100 border-b-2 border-gray-200">
      <tr>
        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500">#</th>
        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500">
          <button class="flex items-center gap-1 hover:text-gray-700 transition-colors" (click)="sortBy('employee')">
            Employee
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path *ngIf="sortColumn !== 'employee'" d="M5 8l5-5 5 5H5zm0 4l5 5 5-5H5z" opacity="0.3" />
              <path *ngIf="sortColumn === 'employee' && sortDirection === 'asc'" d="M5 8l5-5 5 5H5z" />
              <path *ngIf="sortColumn === 'employee' && sortDirection === 'desc'" d="M5 12l5 5 5-5H5z" />
            </svg>
          </button>
        </th>
        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500">
          <button class="flex items-center gap-1 hover:text-gray-700 transition-colors" (click)="sortBy('department')">
            Department
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path *ngIf="sortColumn !== 'department'" d="M5 8l5-5 5 5H5zm0 4l5 5 5-5H5z" opacity="0.3" />
              <path *ngIf="sortColumn === 'department' && sortDirection === 'asc'" d="M5 8l5-5 5 5H5z" />
              <path *ngIf="sortColumn === 'department' && sortDirection === 'desc'" d="M5 12l5 5 5-5H5z" />
            </svg>
          </button>
        </th>
        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500">
          <button class="flex items-center gap-1 hover:text-gray-700 transition-colors" (click)="sortBy('type')">
            Type Name
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path *ngIf="sortColumn !== 'type'" d="M5 8l5-5 5 5H5zm0 4l5 5 5-5H5z" opacity="0.3" />
              <path *ngIf="sortColumn === 'type' && sortDirection === 'asc'" d="M5 8l5-5 5 5H5z" />
              <path *ngIf="sortColumn === 'type' && sortDirection === 'desc'" d="M5 12l5 5 5-5H5z" />
            </svg>
          </button>
        </th>
        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500">
          <button class="flex items-center gap-1 hover:text-gray-700 transition-colors" (click)="sortBy('dates')">
            Dates
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path *ngIf="sortColumn !== 'dates'" d="M5 8l5-5 5 5H5zm0 4l5 5 5-5H5z" opacity="0.3" />
              <path *ngIf="sortColumn === 'dates' && sortDirection === 'asc'" d="M5 8l5-5 5 5H5z" />
              <path *ngIf="sortColumn === 'dates' && sortDirection === 'desc'" d="M5 12l5 5 5-5H5z" />
            </svg>
          </button>
        </th>
        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500">Status</th>
        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500">
          <button class="flex items-center gap-1 hover:text-gray-700 transition-colors" (click)="sortBy('submitted')">
            Submitted
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path *ngIf="sortColumn !== 'submitted'" d="M5 8l5-5 5 5H5zm0 4l5 5 5-5H5z" opacity="0.3" />
              <path *ngIf="sortColumn === 'submitted' && sortDirection === 'asc'" d="M5 8l5-5 5 5H5z" />
              <path *ngIf="sortColumn === 'submitted' && sortDirection === 'desc'" d="M5 12l5 5 5-5H5z" />
            </svg>
          </button>
        </th>
        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500">Actions</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-200 table-scroll-inner">
      <tr *ngFor="let req of filteredRequests; let i = index" class="hover:bg-gray-50 border-l-4"
        [ngClass]="{
          'border-yellow-400': req.status === 'Pending',
          'border-green-400': req.status === 'Approved',
          'border-red-400': req.status === 'Rejected',
          'border-gray-400': req.status === 'Invalid' || req.status === 'Expired' || req.status === 'Canceled',
          'border-blue-400': req.status === 'Arrived',
          'border-transparent': req.status === undefined
        }">
        <td class="px-6 py-4 text-sm text-gray-900 font-mono">{{ ((currentPage - 1) * itemsPerPage) + i + 1 }}</td>
        <td class="px-6 py-4 text-sm text-gray-900">{{ req.employeeName }}</td>
        <td class="px-6 py-4 text-sm text-gray-700">{{ req.departmentName || "-" }}</td>
        <td class="px-6 py-4 text-sm text-gray-700">{{ req.leaveType?.title || "-" }}</td>
        <td class="px-6 py-4 text-sm text-gray-700">{{ req.from }}–{{ req.to }}</td>
        <td class="px-6 py-4">
          <span class="px-2 inline-flex text-xs font-semibold rounded-full"
            [ngClass]="{
              'bg-yellow-100 text-yellow-800': req.status === 'Pending',
              'bg-green-100 text-green-800': req.status === 'Approved',
              'bg-red-100 text-red-800': req.status === 'Rejected',
              'bg-gray-100 text-gray-800': req.status === 'Invalid' || req.status === 'Expired' || req.status === 'Canceled',
              'bg-blue-100 text-blue-800': req.status === 'Arrived'
            }">
            {{ req.status }}
          </span>
        </td>
        <td class="px-6 py-4 text-sm text-gray-500">{{ req.createdAt }}</td>
        <td class="px-6 py-4">
          <button class="rounded bg-gradient-to-r from-[#7EE3DB] to-[#88F8BF] hover:bg-gradient-to-t border border-slate-500 text-slate-900 px-3 py-1 text-sm font-medium hover:cursor-pointer transition-all duration-200 transform"
            (click)="openDetails(req)">Details</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Pagination -->
<div
  *ngIf="viewMode === 'table' && !searchTerm"
  class="bg-white px-4 py-3 flex items-center justify-between border border-gray-200 rounded-lg sm:px-6 mt-4"
>
  <div class="flex-1 flex justify-between items-center sm:hidden">
    <button
      (click)="goToPreviousPage()"
      [disabled]="currentPage === 1"
      class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
    >
      Previous
    </button>
    <span class="text-sm text-gray-700">
      Page {{ currentPage }} of {{ totalPages }}
    </span>
    <button
      (click)="goToNextPage()"
      [disabled]="currentPage === totalPages"
      class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
    >
      Next
    </button>
  </div>
  <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
    <div class="flex items-center gap-4">
      <p class="text-sm text-gray-700">
        Showing
        <span class="font-medium">{{ ((currentPage - 1) * itemsPerPage) + 1 }}</span>
        to
        <span class="font-medium">{{ Math.min(currentPage * itemsPerPage, totalCount) }}</span>
        of
        <span class="font-medium">{{ totalCount }}</span>
        results
      </p>
      <div class="flex items-center gap-2">
        <label for="itemsPerPage" class="text-sm text-gray-700">Show:</label>
        <select
          id="itemsPerPage"
          [(ngModel)]="itemsPerPage"
          (ngModelChange)="onItemsPerPageChange()"
          class="px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
        <span class="text-sm text-gray-700">per page</span>
      </div>
    </div>
    <div>
      <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
        <!-- First page button -->
        <button
          (click)="goToFirstPage()"
          [disabled]="currentPage === 1"
          class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
          title="First page"
        >
          <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M15.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414zm-6 0a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 011.414 1.414L5.414 10l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
          </svg>
        </button>

        <!-- Previous page button -->
        <button
          (click)="goToPreviousPage()"
          [disabled]="currentPage === 1"
          class="relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
          title="Previous page"
        >
          <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
          </svg>
        </button>

        <!-- Page numbers -->
        <button
          *ngFor="let page of getPageNumbers()"
          (click)="goToPage(page)"
          [class]="
            page === currentPage
              ? 'relative inline-flex items-center px-4 py-2 border border-[#7EE3DB] bg-[#7EE3DB] text-sm font-medium text-slate-900'
              : 'relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50'
          "
        >
          {{ page }}
        </button>

        <!-- Show ellipsis if there are more pages -->
        <span
          *ngIf="totalPages > 5 && currentPage < totalPages - 2"
          class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700"
        >
          ...
        </span>

        <!-- Next page button -->
        <button
          (click)="goToNextPage()"
          [disabled]="currentPage === totalPages"
          class="relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
          title="Next page"
        >
          <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
          </svg>
        </button>

        <!-- Last page button -->
        <button
          (click)="goToLastPage()"
          [disabled]="currentPage === totalPages"
          class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
          title="Last page"
        >
          <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10.293 15.707a1 1 0 010-1.414L14.586 10l-4.293-4.293a1 1 0 111.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0zm-6 0a1 1 0 010-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z" clip-rule="evenodd" />
          </svg>
        </button>
      </nav>
    </div>
  </div>
</div>

<div *ngIf="viewMode === 'calendar'">
  <app-calendar-view [requests]="requests"> </app-calendar-view>
</div>

<div
  *ngIf="selectedRequest"
  class="fixed inset-0 z-50 flex items-center justify-center bg-black/40"
>
  <div class="relative w-full max-w-xl mx-auto">
    <app-request-detail
      [request]="selectedRequest"
      (approve)="onApprove($event)"
      (reject)="onReject($event)"
      (actionCompleted)="onActionCompleted()"
    ></app-request-detail>
    <button
      class="absolute top-2 right-2 bg-gray-200 px-3 py-1 rounded hover:cursor-pointer transition-all duration-200 transform hover:scale-105"
      (click)="closeDetails()"
    >
      Close
    </button>
  </div>
</div>
<button
  *ngIf="selectedRequest"
  class="fixed top-4 right-4 bg-gray-200 px-3 py-1 rounded transition-all duration-200 transform hover:scale-105"
  (click)="closeDetails()"
>
  Close
</button>
