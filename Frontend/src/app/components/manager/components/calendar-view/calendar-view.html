<div class="bg-white rounded-lg shadow-sm border">
  <div
    class="flex items-center justify-between p-4 border-b bg-gradient-to-r from-[#7EE3DB]/10 to-[#88F8BF]/10"
  >
    <h2 class="text-2xl font-bold text-slate-900">Calendar Angajați</h2>

    <div class="flex items-center gap-3">
      <button
        (click)="toggleFilter('pending')"
        class="flex items-center gap-2 p-1 rounded-lg transition-all duration-200 transform hover:scale-105"
        [ngClass]="{
          'bg-yellow-200 border-2 border-yellow-400 shadow-md':
            calendarFilters.pending,
          'bg-gray-100 border border-gray-300 opacity-50':
            !calendarFilters.pending
        }"
      >
        <div
          class="w-3 h-3 bg-yellow-100 border border-yellow-200 rounded"
        ></div>
        <span
          [ngClass]="{
            'font-semibold text-yellow-800': calendarFilters.pending,
            'text-gray-500': !calendarFilters.pending
          }"
          >Pending</span
        >
        <svg
          *ngIf="calendarFilters.pending"
          class="w-4 h-4 text-yellow-600"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M5 13l4 4L19 7"
          ></path>
        </svg>
      </button>

      <button
        (click)="toggleFilter('approved')"
        class="flex items-center gap-2 p-1 rounded-lg transition-all duration-200 transform hover:scale-105"
        [ngClass]="{
          'bg-green-200 border-2 border-green-400 shadow-md':
            calendarFilters.approved,
          'bg-gray-100 border border-gray-300 opacity-50':
            !calendarFilters.approved
        }"
      >
        <div class="w-3 h-3 bg-green-100 border border-green-200 rounded"></div>
        <span
          [ngClass]="{
            'font-semibold text-green-800': calendarFilters.approved,
            'text-gray-500': !calendarFilters.approved
          }"
          >Approved</span
        >
        <svg
          *ngIf="calendarFilters.approved"
          class="w-4 h-4 text-green-600"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M5 13l4 4L19 7"
          ></path>
        </svg>
      </button>
    </div>

    <div class="flex items-center gap-3">
      <div class="flex items-center gap-2">
        <label class="text-sm font-medium text-gray-700">Luni:</label>
        <select
          [(ngModel)]="displayMonths"
          (ngModelChange)="onMonthsChange($event)"
          class="px-3 py-1 pr-8 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-blue-400 hover:shadow-sm focus:outline-none focus:shadow-md transition-all duration-200"
        >
          <option *ngFor="let months of monthsOptions" [value]="months">
            {{ months }} {{ months === 1 ? "lună" : "luni" }}
          </option>
        </select>
      </div>

      <div class="flex items-center gap-1">
        <button
          (click)="previousMonth()"
          class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            ></path>
          </svg>
        </button>
        <button
          (click)="nextMonth()"
          class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"
            ></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div
    class="overflow-x-auto max-h-[600px] overflow-y-auto scroll-smooth border border-gray-200 rounded-lg select-none"
    (wheel)="onWheel($event)"
    style="
      scroll-behavior: smooth;
      scrollbar-width: thin;
      scrollbar-color: #d1d5db #f9fafb;
    "
  >
    <table class="w-full border-collapse text-sm">
      <thead class="sticky top-0 bg-white z-10">
        <tr>
          <th
            class="sticky left-0 bg-gray-100 border border-gray-300 px-2 py-1 font-semibold text-gray-700 min-w-[150px] z-20 text-left cursor-default"
          >
            Angajat
          </th>
          <ng-container *ngFor="let monthHeader of monthHeaders">
            <th
              class="border border-gray-300 px-2 py-1 font-semibold text-gray-700 text-center bg-blue-50"
              [attr.colspan]="monthHeader.daysInMonth"
            >
              {{ monthHeader.month }} {{ monthHeader.year }}
            </th>
          </ng-container>
        </tr>
        <tr>
          <th
            class="sticky left-0 bg-gray-100 border border-gray-300 p-1 text-xs text-gray-600 z-20"
          >
            Nume
          </th>
          <th
            *ngFor="let date of calendarDates"
            class="border border-gray-300 p-1 text-xs text-gray-600 min-w-[40px] bg-gray-50"
            [ngClass]="{
              'bg-blue-200 font-bold': isToday(date)
            }"
          >
            {{ date.getDate() }}
          </th>
        </tr>
      </thead>

      <tbody>
        <tr
          *ngFor="let employeeData of tableData; let i = index"
          class="hover:bg-gray-50 text-sm"
          [ngClass]="{ 'bg-gray-25': i % 2 === 0 }"
        >
          <td
            class="sticky left-0 bg-white border border-gray-300 px-2 py-1 font-medium text-gray-800 z-10 text-left cursor-default min-w-[150px]"
            [ngClass]="{ 'bg-gray-25': i % 2 === 0 }"
          >
            {{ employeeData.employee }}
          </td>

          <td
            *ngFor="let dateData of employeeData.dates"
            class="border border-gray-300 p-1 text-center transition-colors min-w-[40px] h-8 w-10"
            [ngClass]="{
              'bg-green-200 hover:bg-green-300 text-green-800 font-bold':
                dateData.hasLeave &&
                dateData.requests.length > 0 &&
                getStatusColor(dateData.requests[0].status).includes('green') &&
                !isDateInHoveredRequest(dateData.date),
              'bg-green-300 text-green-800 font-bold':
                dateData.hasLeave &&
                dateData.requests.length > 0 &&
                getStatusColor(dateData.requests[0].status).includes('green') &&
                isDateInHoveredRequest(dateData.date),
              'bg-yellow-200 hover:bg-yellow-300 text-yellow-800 font-bold':
                dateData.hasLeave &&
                dateData.requests.length > 0 &&
                getStatusColor(dateData.requests[0].status).includes(
                  'yellow'
                ) &&
                !isDateInHoveredRequest(dateData.date),
              'bg-yellow-300 text-yellow-800 font-bold':
                dateData.hasLeave &&
                dateData.requests.length > 0 &&
                getStatusColor(dateData.requests[0].status).includes(
                  'yellow'
                ) &&
                isDateInHoveredRequest(dateData.date),
              'hover:bg-gray-100': !dateData.hasLeave,
              'bg-blue-200 font-bold': isToday(dateData.date),
              'cursor-pointer':
                dateData.hasLeave && dateData.requests.length > 0,
              'cursor-default':
                !dateData.hasLeave || dateData.requests.length === 0
            }"
            (click)="onCellClick(employeeData.employee, dateData.date)"
            (mouseenter)="
              dateData.hasLeave && dateData.requests.length > 0
                ? onRequestHover(dateData.requests[0])
                : null
            "
            (mouseleave)="onRequestLeave()"
            [title]="
              dateData.hasLeave && dateData.requests.length > 0
                ? dateData.requests[0].reason || 'Concediu'
                : ''
            "
          >
            <span *ngIf="dateData.hasLeave" class="text-xs font-bold"> ✓ </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div
    *ngIf="selectedRequest"
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/40"
  >
    <div class="relative w-full max-w-xl mx-auto">
      <app-request-detail
        [request]="selectedRequest"
        (approve)="onApprove($event)"
        (reject)="onReject($event)"
      ></app-request-detail>
      <button
        class="absolute top-2 right-2 bg-gray-200 px-3 py-1 rounded hover:cursor-pointer transition-all duration-200 transform hover:scale-105"
        (click)="closeDetails()"
      >
        ✕
      </button>
    </div>
  </div>
</div>
