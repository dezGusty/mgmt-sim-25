<nav class="border-b top-0 z-50 bg-[#020126]">
  <div class="px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-20">
      <div class="flex items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity" (click)="goHome()">
        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
          <path fill="#7EE3DB"
            d="M381 114.9L186.1 41.8c-16.7-6.2-35.2-5.3-51.1 2.7L89.1 67.4C78 73 77.2 88.5 87.6 95.2l146.9 94.5L136 240 77.8 214.1c-8.7-3.9-18.8-3.7-27.3 .6L18.3 230.8c-9.3 4.7-11.8 16.8-5 24.7l73.1 85.3c6.1 7.1 15 11.2 24.3 11.2l137.7 0c5 0 9.9-1.2 14.3-3.4L535.6 212.2c46.5-23.3 82.5-63.3 100.8-112C645.9 75 627.2 48 600.2 48l-57.4 0c-20.2 0-40.2 4.8-58.2 14L381 114.9zM0 480c0 17.7 14.3 32 32 32l576 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 448c-17.7 0-32 14.3-32 32z" />
        </svg>
        <h1 class="text-2xl font-bold text-white">FT D Management App <span class="text-xs font-light text-[#7EE3DB]/70 align-bottom relative top-1">{{ appVersion }}</span></h1>
      </div>

      <div class="flex items-center gap-4">
        <div class="relative role-dropdown-container">
          <div
            class="flex items-center gap-3 bg-[#020126] px-3 py-2 rounded-lg border border-[#7EE3DB]/30 hover:bg-[#7EE3DB]/10 hover:border-[#7EE3DB]/50 transition-all duration-300 cursor-pointer group"
            (click)="toggleRoleDropdown()">
            <div class="flex items-center gap-2">
              <div *ngIf="!isRoleSelectorPage()" class="w-1.5 h-1.5 rounded-full {{ getPageColor() }} animate-pulse">
              </div>
              <div *ngIf="isRoleSelectorPage()"
                class="w-4 h-4 rounded-full border-2 border-white/20 border-t-[#7EE3DB] animate-spin"></div>
              <span *ngIf="getPageRole()"
                class="text-xs font-semibold uppercase tracking-wide bg-gray-600 text-white bg-white/20 px-2 py-0.5 rounded border border-white/30">
                {{ getPageRole() }}
              </span>

              <!-- Second Manager Badge -->
              <span *ngIf="isActingAsSecondManager"
                class="text-xs font-semibold uppercase tracking-wide bg-orange-500 text-white px-2 py-0.5 rounded border border-orange-400">
                Second Manager
              </span>

              <!-- View Only Badge -->
              <span *ngIf="isTemporarilyReplaced"
                class="text-xs font-semibold uppercase tracking-wide bg-gray-500 text-white px-2 py-0.5 rounded border border-gray-400">
                View Only
              </span>
              <!-- Dropdown arrow -->
              <svg *ngIf="userRoles.length > 1 || isCurrentlyImpersonating" class="w-4 h-4 text-white/70 transition-transform duration-200"
                [class.rotate-180]="showRoleDropdown" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>
            <div class="h-3 w-px bg-[#7EE3DB]/40"></div>
            <div class="flex flex-col">
              <span class="text-white/90 group-hover:text-white transition-colors duration-300 text-sm font-medium">
                {{ userEmail }}
              </span>
              <span *ngIf="isCurrentlyImpersonating && originalAdminEmail" class="text-xs text-[#22e6bb]">
                Admin: {{ originalAdminEmail }}
              </span>
            </div>
          </div>

          <!-- Role Dropdown -->
          <div *ngIf="showRoleDropdown && (userRoles.length > 1 || isCurrentlyImpersonating)"
            class="absolute right-0 mt-2 w-[28rem] bg-white rounded-lg shadow-xl border border-gray-200 z-50">
            <div class="p-3 border-b border-gray-100">
              <p class="text-xs text-gray-500 font-medium">SWITCH ROLE</p>
            </div>
            <div class="py-2 px-3">
              <!-- When impersonating: Show only impersonated user roles -->
              <div *ngIf="isCurrentlyImpersonating">
                <p class="text-xs font-semibold text-gray-500 mb-1">
                  {{ availableRoles.length === 1 ? 'Current Role' : 'Available Roles' }}
                </p>
                <div *ngFor="let role of availableRoles" (click)="switchRole(role)"
                  class="flex items-center gap-3 px-3 py-2 hover:bg-gray-50 cursor-pointer rounded transition-colors duration-150"
                  [class.cursor-default]="availableRoles.length === 1"
                  [class.hover:bg-gray-50]="availableRoles.length > 1">
                  <div class="w-2 h-2 rounded-full {{ getRoleColor(role.name) }}"></div>
                  <div class="flex-1">
                    <p class="text-sm font-medium text-gray-900">{{ role.displayName }}</p>
                    <p class="text-xs text-gray-500">{{ role.description }}</p>
                  </div>
                  <div *ngIf="getPageRole() === role.name" class="w-2 h-2 rounded-full bg-green-500"></div>
                </div>
              </div>
              
              <!-- When not impersonating: Show normal user roles -->
              <div *ngIf="!isCurrentlyImpersonating">
                <p class="text-xs font-semibold text-gray-500 mb-1">Your Roles</p>
                <div *ngFor="let role of availableRoles" (click)="switchRole(role)"
                  class="flex items-center gap-3 px-3 py-2 hover:bg-gray-50 cursor-pointer rounded transition-colors duration-150">
                  <div class="w-2 h-2 rounded-full {{ getRoleColor(role.name) }}"></div>
                  <div class="flex-1">
                    <p class="text-sm font-medium text-gray-900">{{ role.displayName }}</p>
                    <p class="text-xs text-gray-500">{{ role.description }}</p>
                  </div>
                  <div *ngIf="getPageRole() === role.name" class="w-2 h-2 rounded-full bg-green-500"></div>
                </div>
              </div>
            </div>
            <div class="p-3 border-t border-gray-100">
              <button *ngIf="isCurrentlyImpersonating" (click)="stopImpersonation()"
                class="w-full mb-2 px-3 py-2 text-center text-sm bg-red-50 hover:bg-red-100 text-red-700 hover:text-red-800 font-medium rounded-lg border border-red-200 hover:border-red-300 transition-all duration-150">
                Stop Impersonating
              </button>
              <button (click)="goToRoleSelector()"
                class="w-full text-center text-sm text-[#7EE3DB] hover:text-[#88F8BF] font-medium transition-colors duration-150">
                View All Roles
              </button>
            </div>
          </div>
        </div>
        <button (click)="logout()"
          class="flex items-center gap-1 px-3 py-1 rounded bg-gradient-to-r from-[#7EE3DB] to-[#88F8BF] hover:bg-gradient-to-t border border-slate-500 text-slate-900 font-semibold transition-all duration-200 transform hover:scale-105 text-sm">
          Logout
        </button>
      </div>
    </div>
  </div>
</nav>