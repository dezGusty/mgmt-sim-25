<!-- User Relationships Component -->
<div class="space-y-6">
  
  <!-- Search Bar Section - Single Row -->
  <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
    <div class="flex flex-wrap items-center gap-3">
      <!-- Search Input -->
      <div class="flex-1 min-w-60">
        <input 
          type="text" 
          [(ngModel)]="searchTerm"
          class="block w-full px-3 py-2 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-[#20B486] focus:border-[#20B486] text-sm"
          [placeholder]="getSearchPlaceholder()"
        >
      </div>
      
      <!-- Search/Sort By Dropdown -->
      <div class="w-36">
        <select 
          [(ngModel)]="searchBy"
          class="block w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-sm focus:outline-none focus:ring-1 focus:ring-[#20B486] focus:border-[#20B486]"
          >
          <option value="lastName" [selected]="searchBy === 'lastName'">By Name</option>
          <option value="email" [selected]="searchBy === 'email'" >By Email</option>
        </select>
      </div>
      
      <!-- Sort Order Toggle -->
      <div class="flex items-center">
        <button 
          (click)="toggleSortOrder()"
          class="flex items-center px-3 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-50 text-sm focus:outline-none focus:ring-1 focus:ring-[#20B486] focus:border-[#20B486] transition-colors"
          [title]="sortDescending ? 'Descending (Z-A)' : 'Ascending (A-Z)'"
        >
          <svg *ngIf="!sortDescending" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12" />
          </svg>
          <svg *ngIf="sortDescending" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 13l-5 5m0 0l-5-5m5 5V6" />
          </svg>
          <span class="ml-1 text-xs text-gray-600">{{ sortDescending ? 'Z-A' : 'A-Z' }}</span>
        </button>
      </div>
      
      <!-- Search Button -->
      <button 
        (click)="onSearch()"
        class="px-4 py-2 bg-[#20B486] hover:bg-[#1a9c75] text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-2"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        Search
      </button>
      
      <!-- Clear Button -->
      <button 
        *ngIf="searchTerm"
        (click)="clearSearch()"
        class="px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg text-sm transition-colors"
        title="Clear search"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Admin Level -->
  <div class="mb-8">
    <div class="flex items-center space-x-3 mb-4">
      <div class="p-2 bg-red-100 rounded-lg">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 text-red-600">
          <path fill-rule="evenodd" d="M12.516 2.17a.75.75 0 00-1.032 0 11.209 11.209 0 01-7.877 3.08.75.75 0 00-.722.515A12.74 12.74 0 002.25 9.75c0 5.814 3.051 10.923 7.613 13.777a.75.75 0 00.774 0C15.199 20.673 18.25 15.564 18.25 9.75a12.74 12.74 0 00-.635-4.235.75.75 0 00-.722-.515 11.209 11.209 0 01-7.877-3.08z" clip-rule="evenodd" />
        </svg>
      </div>
      <h4 class="text-md font-medium text-gray-900">System Administrators</h4>
      <span class="px-2 py-1 bg-red-100 text-red-800 text-xs font-medium rounded-full">{{ getAdminCount() }} users</span>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 ml-8">
      <div *ngFor="let admin of admins" class="flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
        <img class="h-10 w-10 rounded-full object-cover" 
             [src]="admin.avatar || 'https://ui-avatars.com/api/?name=' + admin.name + '&background=ef4444&color=fff'" 
             [alt]="admin.name">
        <div>
          <div class="text-sm font-medium text-gray-900">{{ admin.name }}</div>
          <div class="text-xs text-gray-500">{{ admin.email }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Manager Level -->
  <div class="mb-8">
    <div class="flex items-center space-x-3 mb-4">
      <div class="p-2 bg-green-100 rounded-lg">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 text-green-600">
          <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z" clip-rule="evenodd" />
        </svg>
      </div>
      <h4 class="text-md font-medium text-gray-900">Team Managers</h4>
      <span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">{{ getManagerCount() }} managers</span>
    </div>

    <div *ngFor="let manager of managers" class="mb-6 bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
      <!-- Header-ul managerului -->
      <div class="bg-white border-b border-gray-200 p-4">
        <div class="flex items-center space-x-3">
          <img class="h-12 w-12 rounded-full object-cover border-2 border-[#20B486]" 
              [src]="manager.avatar || 'https://ui-avatars.com/api/?name=' + manager.name + '&background=20B486&color=fff'" 
              [alt]="manager.name">
          <div>
            <div class="text-lg font-semibold text-gray-900">{{ manager.name }}</div>
            <div class="text-xs text-gray-500">{{ manager.email }}</div>
            <div class="text-sm text-gray-600">{{ manager.jobTitle?.name }} - {{ manager.jobTitle?.department?.name }}</div>
            <div class="flex items-center space-x-2 mt-1">
              <span class="px-2 py-1 bg-[#20B486] text-white text-xs rounded-full">Manager</span>
              <span class="text-xs text-gray-500">{{ getSubordinateCount(manager) }} direct reports</span>
            </div>
          </div>
        </div>
      </div>

      <div class="p-4">
        <div *ngIf="manager.subordinatesNames && manager.subordinatesNames.length > 0; else noSubordinates">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            <div *ngFor="let subordinateName of manager.subordinatesNames; let i = index;" 
                class="flex items-center space-x-3 p-3 bg-white border border-gray-200 rounded-lg">
              <img class="h-10 w-10 rounded-full object-cover" 
                  [src]="'https://ui-avatars.com/api/?name=' + subordinateName + '&background=6b7280&color=eee'" 
                  [alt]="subordinateName">
              <div class="flex-1 min-w-0">
                <div class="text-sm font-medium text-gray-900 truncate">{{ subordinateName }}</div>
                <div class="text-xs text-gray-500">{{ manager.subordinatesEmails?.[i] }}</div>
                <div class="text-xs text-gray-500 truncate">{{ manager.subordinatesJobTitleNames?.[i] }}</div>
                <div *ngIf="isManager(manager.subordinatesIds?.[i])" class="flex items-center space-x-2 mt-1">
                  <span class="px-2 py-1 bg-[#20B486] text-white text-xs rounded-full">Manager</span>
                </div>
                <div *ngIf="isAdmin(manager.subordinatesIds?.[i])" class="flex items-center space-x-2 mt-1">
                  <span class="px-2 py-1 bg-red-600 text-white text-xs rounded-full">Admin</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <ng-template #noSubordinates>
          <div class="text-center py-4">
            <div class="text-gray-400 text-sm">No team members assigned</div>
          </div>
        </ng-template>
      </div>
    </div>

    <div *ngIf="totalPagesManagers > 1" class="bg-white px-4 py-3 flex items-center justify-between border border-gray-200 rounded-lg sm:px-6 mt-6">
      <div class="flex-1 flex justify-between items-center sm:hidden">
        <button 
          (click)="goToPreviousPageManagers()" 
          [disabled]="currentPageManagers === 1"
          class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
        >
          Previous
        </button>
        <span class="text-sm text-gray-700">
          Page {{ currentPageManagers }} of {{ totalPagesManagers }}
        </span>
        <button 
          (click)="goToNextPageManagers()" 
          [disabled]="currentPageManagers === totalPagesManagers"
          class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
        >
          Next
        </button>
      </div>
      
      <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
        <div>
          <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
            <!-- First page button -->
            <button 
              (click)="goToFirstPageManagers()" 
              [disabled]="currentPageManagers === 1"
              class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
              title="First page"
            >
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M15.707 15.707a1 1 0 01-1.414 0L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
              </svg>
            </button>

            <!-- Previous page button -->
            <button 
              (click)="goToPreviousPageManagers()" 
              [disabled]="currentPageManagers === 1"
              class="relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
              title="Previous page"
            >
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
              </svg>
            </button>

            <!-- Page numbers -->
            <button 
              *ngFor="let page of getPageNumbersManagers()" 
              (click)="goToPageManagers(page)"
              [class]="page === currentPageManagers 
                ? 'relative inline-flex items-center px-4 py-2 border border-[#20B486] bg-[#20B486] text-sm font-medium text-white'
                : 'relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50'"
            >
              {{ page }}
            </button>

            <!-- Show ellipsis if there are more pages -->
            <span *ngIf="totalPagesManagers > 5 && currentPageManagers < totalPagesManagers - 2" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
              ...
            </span>

            <!-- Next page button -->
            <button 
              (click)="goToNextPageManagers()" 
              [disabled]="currentPageManagers === totalPagesManagers"
              class="relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
              title="Next page"
            >
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
              </svg>
            </button>

            <!-- Last page button -->
            <button 
              (click)="goToLastPageManagers()" 
              [disabled]="currentPageManagers === totalPagesManagers"
              class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
              title="Last page"
            >
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10.293 15.707a1 1 0 010-1.414L13.586 11H3a1 1 0 110-2h10.586l-3.293-3.293a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z" clip-rule="evenodd" />
              </svg>
            </button>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <!-- Unassigned Users -->
  <div *ngIf="areUnassignedUsers()" class="border-l-4 border-orange-400 pl-4 mb-8">
    <div class="flex items-center space-x-3 mb-4">
      <div class="p-2 bg-orange-100 rounded-lg">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 text-orange-600">
          <path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z" clip-rule="evenodd" />
        </svg>
      </div>
      <h4 class="text-md font-medium text-gray-900">Unassigned Users</h4>
      <span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs font-medium rounded-full">{{ getUnassignedUsersCount() }} users</span>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 ml-8">
      <div *ngFor="let user of unassignedUsers" class="flex items-center justify-between p-3 border border-orange-200 rounded-lg hover:bg-orange-50">
        <div class="flex items-center space-x-3">
          <img class="h-8 w-8 rounded-full object-cover" 
               [src]="user.avatar || 'https://ui-avatars.com/api/?name=' + user.name + '&background=f97316&color=fff'" 
               [alt]="user.name">
          <div>
            <div class="text-sm font-medium text-gray-900">{{ user.name }}</div>
            <div class="text-xs text-gray-500">{{ user.email }}</div>
            <div class="text-xs text-gray-500">{{ user.jobTitle?.name }}</div>
          </div>
        </div>
        <button class="text-[#20B486] hover:text-[#1a9c75] text-xs font-medium" (click)="assignManager(user)">
          Assign
        </button>
      </div>
    </div>

    <div *ngIf="totalPagesUnassignedUsers > 1" class="bg-white px-4 py-3 flex items-center justify-between border border-gray-200 rounded-lg sm:px-6 mt-6">
      <div class="flex-1 flex justify-between items-center sm:hidden">
        <button 
          (click)="goToPreviousPageUnassignedUsers()" 
          [disabled]="currentPageUnassignedUsers === 1"
          class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
        >
          Previous
        </button>
        <span class="text-sm text-gray-700">
          Page {{ currentPageUnassignedUsers }} of {{ totalPagesUnassignedUsers }}
        </span>
        <button 
          (click)="goToNextPageUnassignedUsers()" 
          [disabled]="currentPageUnassignedUsers === totalPagesUnassignedUsers"
          class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
        >
          Next
        </button>
      </div>
      
      <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
        <div>
          <p class="text-sm text-gray-700">
            Showing
            <span class="font-medium">{{ getStartResultIndexUnassignedUsers() }}</span>
            to
            <span class="font-medium">{{ getMaxDisplayedResultUnassignedUsers() }}</span>
            of
            <span class="font-medium">{{ unassignedUsers.length }}</span>
            unassigned users
          </p>
        </div>
        <div>
          <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
            <!-- First page button -->
            <button 
              (click)="goToFirstPageUnassignedUsers()" 
              [disabled]="currentPageUnassignedUsers === 1"
              class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
              title="First page"
            >
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M15.707 15.707a1 1 0 01-1.414 0L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
              </svg>
            </button>

            <!-- Previous page button -->
            <button 
              (click)="goToPreviousPageUnassignedUsers()" 
              [disabled]="currentPageUnassignedUsers === 1"
              class="relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
              title="Previous page"
            >
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
              </svg>
            </button>

            <!-- Page numbers -->
            <button 
              *ngFor="let page of getPageNumbersUnassignedUsers()" 
              (click)="goToPageUnassignedUsers(page)"
              [class]="page === currentPageUnassignedUsers 
                ? 'relative inline-flex items-center px-4 py-2 border border-orange-400 bg-orange-400 text-sm font-medium text-white'
                : 'relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50'"
            >
              {{ page }}
            </button>

            <!-- Show ellipsis if there are more pages -->
            <span *ngIf="totalPagesUnassignedUsers > 5 && currentPageUnassignedUsers < totalPagesUnassignedUsers - 2" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
              ...
            </span>

            <!-- Next page button -->
            <button 
              (click)="goToNextPageUnassignedUsers()" 
              [disabled]="currentPageUnassignedUsers === totalPagesUnassignedUsers"
              class="relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
              title="Next page"
            >
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
              </svg>
            </button>

            <!-- Last page button -->
            <button 
              (click)="goToLastPageUnassignedUsers()" 
              [disabled]="currentPageUnassignedUsers === totalPagesUnassignedUsers"
              class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"
              title="Last page"
            >
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10.293 15.707a1 1 0 010-1.414L13.586 11H3a1 1 0 110-2h10.586l-3.293-3.293a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z" clip-rule="evenodd" />
              </svg>
            </button>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <!-- No Results Message -->
  <div *ngIf="managers.length === 0" class="text-center py-12">
    <div class="text-gray-400 text-lg mb-2">No managers found</div>
    <div class="text-gray-500 text-sm">Try adjusting your search criteria</div>
  </div>
  
  <!-- Statistics Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="bg-white p-4 rounded-lg border border-gray-200">
      <div class="text-2xl font-bold text-red-600">{{ getAdminCount() }}</div>
      <div class="text-sm text-gray-500">System Admins</div>
    </div>
    <div class="bg-white p-4 rounded-lg border border-gray-200">
      <div class="text-2xl font-bold text-[#20B486]">{{ getManagerCount() }}</div>
      <div class="text-sm text-gray-500">Managers</div>
    </div>
    <div class="bg-white p-4 rounded-lg border border-gray-200">
      <div class="text-2xl font-bold text-orange-600">{{ getUnassignedUsersCount() }}</div>
      <div class="text-sm text-gray-500">Unassigned Users</div>
    </div>
  </div>
</div>